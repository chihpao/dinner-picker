import{_ as ut}from"./DPvAsCCj.js";import{I as dt,_ as rt}from"./ivJW199t.js";import{_ as pt}from"./BF6IhyWh.js";import{u as G,f as F,a as mt,t as H}from"./D8w1TNDh.js";import{e as J,k as S,r as k,l as _t,m as Q,c as a,o as i,a as t,q as y,t as c,f as o,b as g,F as P,h as K,n as f,s as E,v as V,x as Y,u as bt,w as j}from"./lYf44GPV.js";import{I as vt}from"./BbR-qeLV.js";import{u as R}from"./DSc9tJYb.js";import{u as W}from"./BrKs8iOl.js";import{_ as M}from"./DlAUqK2U.js";const yt={class:"panel"},ft={class:"panel-header"},gt={class:"panel-title-group"},kt={key:0,class:"pill"},ht={class:"panel-actions"},xt={key:0,class:"auth-gate panel"},Ct={key:1,class:"empty-state"},wt={key:2,class:"expense-list-container"},$t={class:"expense-list-header"},Dt={class:"header-cell checkbox-cell"},St={class:"custom-checkbox"},Et=["checked","disabled"],It={class:"header-cell"},zt={class:"sort-icon"},At={class:"header-cell text-right"},Mt={class:"sort-icon"},Tt={class:"header-cell"},Bt={class:"sort-icon"},Lt={class:"header-cell"},Nt={class:"sort-icon"},Vt={class:"header-cell"},jt={class:"sort-icon"},Ot={class:"expense-list"},Ut={class:"cell checkbox-cell"},qt={class:"custom-checkbox"},Ft=["checked","onChange"],Ht=["title"],Pt={class:"compact-date"},Kt={key:0,class:"compact-account"},Yt={class:"compact-note"},Gt={class:"cell date-cell"},Jt={class:"entry-date"},Qt={class:"cell amount-cell text-right"},Rt={key:0,class:"badge-income"},Wt={class:"cell type-cell"},Xt={class:"cell account-cell"},Zt=["title"],te={class:"cell actions-cell text-center"},ee=["onClick"],se={key:3,class:"modal-overlay",role:"dialog","aria-modal":"true"},ne={class:"modal-card"},oe={key:4,class:"modal-overlay",role:"dialog","aria-modal":"true"},le={class:"modal-card edit-modal"},ae={class:"edit-form-layout"},ie={class:"edit-group type-group"},ce={class:"type-toggle"},ue={class:"edit-group date-group"},de={class:"input-label"},re={class:"edit-group amount-group"},pe={class:"input-label"},me={class:"quick-tags scrollable"},_e={class:"edit-group detail-group"},be={key:0,class:"input-label"},ve=["value"],ye={key:1,class:"input-label"},fe={class:"input-label flex-grow"},ge={class:"edit-actions"},ke=J({__name:"ExpenseList",setup(T){const{user:_}=G(),{accounts:I}=R(),B=W(),{entries:u,deleteEntry:O,updateEntry:z}=B,h=S(()=>!0),L=S(()=>"消費紀錄列表"),b=k(null),l=_t({date:"",amount:0,note:"",account_id:"",type:"expense",sub_type:"general"}),x=k(!1),r=k(new Set),v=k("date"),C=k("desc"),X=S(()=>[...u.value].sort((e,s)=>{const d=C.value==="asc";if(v.value==="date"){const p=new Date(e.date).getTime(),m=new Date(s.date).getTime();return d?p-m:m-p}if(v.value==="amount")return d?e.amount-s.amount:s.amount-e.amount;if(v.value==="account_id"){const p=A(e.account_id),m=A(s.account_id);return d?p.localeCompare(m):m.localeCompare(p)}if(v.value==="note"){const p=e.note||"",m=s.note||"";return d?p.localeCompare(m):m.localeCompare(p)}if(v.value==="sub_type"){const p=e.sub_type||"",m=s.sub_type||"";return d?p.localeCompare(m):m.localeCompare(p)}return 0})),w=n=>v.value!==n?"":C.value==="desc"?"↓":"↑",$=S(()=>r.value.size),U=S(()=>u.value.length>0&&r.value.size===u.value.length),Z=n=>{b.value=n.id,l.date=n.date,l.amount=Math.abs(n.amount),l.note=n.note??"",l.account_id=n.account_id??"",l.type=n.amount<0?"income":"expense",l.sub_type=n.sub_type??"general"},tt=()=>{b.value=null},et=async()=>{if(!b.value)return;const n=u.value.find(s=>s.id===b.value);if(!n){b.value=null;return}if(!l.date){alert("請選擇日期");return}const e=l.type==="income"?-Math.abs(l.amount):Math.abs(l.amount);await z({...n,date:l.date,amount:Math.round(e),note:l.note??"",account_id:l.account_id||null,sub_type:l.sub_type}),b.value=null},N=n=>{const e=(l.amount||0)+n;l.amount=Math.max(0,Math.round(e))},st=()=>{l.date=H(new Date)},nt=()=>{const n=new Date;n.setDate(n.getDate()-1),l.date=H(n)},ot=n=>{const e=new Set(r.value);e.has(n)?e.delete(n):e.add(n),r.value=e},q=n=>r.value.has(n),lt=()=>{U.value?r.value=new Set:r.value=new Set(u.value.map(n=>n.id))};Q(u,n=>{const e=new Set(n.map(d=>d.id)),s=new Set;r.value.forEach(d=>{e.has(d)&&s.add(d)}),r.value=s});const D=n=>{v.value===n?C.value=C.value==="desc"?"asc":"desc":(v.value=n,C.value="desc")},at=()=>{$.value&&(x.value=!0)},it=()=>{x.value=!1},ct=async()=>{const n=Array.from(r.value);for(const e of n)await O(e);r.value=new Set,x.value=!1},A=n=>{if(!n)return"未指定";const e=I.value.find(s=>s.id===n);return e?e.name:"未指定"};return(n,e)=>(i(),a("section",yt,[t("div",ft,[t("div",gt,[t("h2",null,c(o(L)),1),o($)?(i(),a("span",kt,"已選 "+c(o($))+" 筆",1)):y("",!0)]),t("div",ht,[o($)?(i(),a("button",{key:0,onClick:at,class:"icon-btn danger",type:"button",title:"刪除選取項目"},[g(dt)])):y("",!0)])]),o(_)?o(u).length?(i(),a("div",wt,[t("div",$t,[t("div",Dt,[t("label",St,[t("input",{type:"checkbox",checked:o(U),onChange:lt,disabled:!o(u).length},null,40,Et),e[16]||(e[16]=t("span",{class:"checkmark"},null,-1))])]),t("div",It,[t("button",{onClick:e[0]||(e[0]=s=>D("date")),type:"button",class:"sort-btn"},[e[17]||(e[17]=t("span",null,"日期",-1)),t("span",zt,c(w("date")),1)])]),t("div",At,[t("button",{onClick:e[1]||(e[1]=s=>D("amount")),type:"button",class:"sort-btn right"},[e[18]||(e[18]=t("span",null,"金額",-1)),t("span",Mt,c(w("amount")),1)])]),t("div",Tt,[t("button",{onClick:e[2]||(e[2]=s=>D("sub_type")),type:"button",class:"sort-btn"},[e[19]||(e[19]=t("span",null,"類型",-1)),t("span",Bt,c(w("sub_type")),1)])]),t("div",Lt,[t("button",{onClick:e[3]||(e[3]=s=>D("account_id")),type:"button",class:"sort-btn"},[e[20]||(e[20]=t("span",null,"帳戶",-1)),t("span",Nt,c(w("account_id")),1)])]),t("div",Vt,[t("button",{onClick:e[4]||(e[4]=s=>D("note")),type:"button",class:"sort-btn"},[e[21]||(e[21]=t("span",null,"備註",-1)),t("span",jt,c(w("note")),1)])]),e[22]||(e[22]=t("div",{class:"header-cell text-center"},"動作",-1))]),t("div",Ot,[(i(!0),a(P,null,K(o(X),s=>(i(),a("article",{key:s.id,class:f(["entry-card",{selected:q(s.id)}])},[t("div",Ut,[t("label",qt,[t("input",{type:"checkbox",checked:q(s.id),onChange:d=>ot(s.id)},null,40,Ft),e[23]||(e[23]=t("span",{class:"checkmark"},null,-1))])]),t("div",{class:"cell compact-main",title:s.note},[t("span",Pt,c(("formatDate"in n?n.formatDate:o(F))(s.date)),1),t("span",{class:f(["type-badge compact-type",s.sub_type==="zibao"?"type-zibao":"type-general"])},c(s.sub_type==="zibao"?"孜保":"一般"),3),o(h)?(i(),a("span",Kt,c(A(s.account_id)),1)):y("",!0),t("span",Yt,c(s.note||"—"),1)],8,Ht),t("div",Gt,[t("span",Jt,c(("formatDate"in n?n.formatDate:o(F))(s.date)),1)]),t("div",Qt,[t("span",{class:f(["entry-amount",s.amount<0?"text-success":""])},c(("formatCurrency"in n?n.formatCurrency:o(mt))(Math.abs(s.amount))),3),s.amount<0?(i(),a("span",Rt,"收")):y("",!0)]),t("div",Wt,[t("span",{class:f(["type-badge",s.sub_type==="zibao"?"type-zibao":"type-general"])},c(s.sub_type==="zibao"?"孜保":"一般"),3)]),t("div",Xt,c(o(h)?A(s.account_id):""),1),t("div",{class:"cell note-cell",title:s.note},c(s.note),9,Zt),t("div",te,[t("button",{class:"icon-btn",onClick:d=>Z(s),type:"button",title:"編輯"},[g(vt)],8,ee)])],2))),128))])])):(i(),a("div",Ct,"目前沒有紀錄，先新增一筆吧！")):(i(),a("div",xt,[...e[15]||(e[15]=[t("p",null,"請先登入再查看/管理紀錄",-1)])])),o(x)?(i(),a("div",se,[t("div",ne,[e[24]||(e[24]=t("h3",null,"刪除紀錄",-1)),t("p",null,"確定要刪除選取的 "+c(o($))+" 筆紀錄嗎？此操作無法復原。",1),t("div",{class:"modal-actions"},[t("button",{class:"btn primary",onClick:ct,type:"button"},"是，刪除"),t("button",{class:"btn",onClick:it,type:"button"},"否，取消")])])])):y("",!0),o(b)?(i(),a("div",oe,[t("div",le,[e[32]||(e[32]=t("h3",null,"編輯紀錄",-1)),t("div",ae,[t("div",ie,[t("div",ce,[t("button",{type:"button",class:f(["btn btn-sm",o(l).type==="expense"?"danger":"outline"]),onClick:e[5]||(e[5]=s=>o(l).type="expense")}," 支出 ",2),t("button",{type:"button",class:f(["btn btn-sm",o(l).type==="income"?"success":"outline"]),onClick:e[6]||(e[6]=s=>o(l).type="income")}," 收入 ",2)])]),t("div",ue,[t("label",de,[e[25]||(e[25]=t("span",null,"日期",-1)),E(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=s=>o(l).date=s)},null,512),[[V,o(l).date]])]),t("div",{class:"quick-tags"},[t("button",{class:"tag-btn",type:"button",onClick:st},"今天"),t("button",{class:"tag-btn",type:"button",onClick:nt},"昨天")])]),t("div",re,[t("label",pe,[e[26]||(e[26]=t("span",null,"金額",-1)),E(t("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=s=>o(l).amount=s),min:"0",step:"1"},null,512),[[V,o(l).amount,void 0,{number:!0}]])]),t("div",me,[t("button",{class:"tag-btn",type:"button",onClick:e[9]||(e[9]=s=>N(10))},"+10"),t("button",{class:"tag-btn",type:"button",onClick:e[10]||(e[10]=s=>N(50))},"+50"),t("button",{class:"tag-btn",type:"button",onClick:e[11]||(e[11]=s=>N(100))},"+100")])]),t("div",_e,[o(h)?(i(),a("label",be,[e[28]||(e[28]=t("span",null,"帳戶",-1)),E(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>o(l).account_id=s)},[e[27]||(e[27]=t("option",{value:""},"未指定",-1)),(i(!0),a(P,null,K(o(I),s=>(i(),a("option",{key:s.id,value:s.id},c(s.name),9,ve))),128))],512),[[Y,o(l).account_id]])])):y("",!0),o(l).type==="expense"?(i(),a("label",ye,[e[30]||(e[30]=t("span",null,"類型",-1)),E(t("select",{"onUpdate:modelValue":e[13]||(e[13]=s=>o(l).sub_type=s)},[...e[29]||(e[29]=[t("option",{value:"general"},"一般",-1),t("option",{value:"zibao"},"孜保平分",-1)])],512),[[Y,o(l).sub_type]])])):y("",!0),t("label",fe,[e[31]||(e[31]=t("span",null,"備註",-1)),E(t("input",{type:"text","onUpdate:modelValue":e[14]||(e[14]=s=>o(l).note=s),placeholder:"備註..."},null,512),[[V,o(l).note]])])]),t("div",ge,[t("button",{class:f(["btn",o(l).type==="income"?"success":"primary"]),onClick:et,type:"button"},"儲存",2),t("button",{class:"btn",onClick:tt,type:"button"},"取消")])])])])):y("",!0)]))}}),he=Object.assign(M(ke,[["__scopeId","data-v-2a2dff9f"]]),{__name:"ExpenseList"}),xe={},Ce={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"square","stroke-linejoin":"miter"};function we(T,_){return i(),a("svg",Ce,[..._[0]||(_[0]=[t("line",{x1:"18",y1:"20",x2:"18",y2:"10"},null,-1),t("line",{x1:"12",y1:"20",x2:"12",y2:"4"},null,-1),t("line",{x1:"6",y1:"20",x2:"6",y2:"14"},null,-1)])])}const $e=Object.assign(M(xe,[["render",we]]),{__name:"IconsIconChartLine"}),De={},Se={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"};function Ee(T,_){return i(),a("svg",Se,[..._[0]||(_[0]=[t("line",{x1:"12",y1:"5",x2:"12",y2:"19"},null,-1),t("line",{x1:"5",y1:"12",x2:"19",y2:"12"},null,-1)])])}const Ie=Object.assign(M(De,[["render",Ee]]),{__name:"IconsIconPlus"}),ze={class:"icon-btn-content"},Ae={class:"icon-btn-content"},Me={class:"expense-main"},Te=J({__name:"index",setup(T){const{user:_}=G(),{loadEntries:I}=W(),{loadAccounts:B}=R(),u=k(!1);return bt({title:"全消費總覽｜今晚吃哪家？",meta:[{name:"theme-color",content:"#1b1b1b"}]}),Q(_,()=>{I(),B()},{immediate:!0}),(O,z)=>{const h=ut,L=rt,b=pt,l=he;return i(),a("div",null,[g(b,{title:"全消費總覽","is-expenses":!0},{actions:j(()=>[t("button",{class:f(["btn btn-sm",{primary:o(u)}]),onClick:z[0]||(z[0]=x=>u.value=!o(u)),type:"button",title:"統計"},[t("span",ze,[g($e,{class:"w-4 h-4"})])],2),g(h,{to:"/total/entry?from=/total",class:"btn btn-sm primary",title:"新增"},{default:j(()=>[t("span",Ae,[g(Ie,{class:"w-4 h-4"})])]),_:1})]),bottom:j(()=>[g(L,{"is-open":o(u)},null,8,["is-open"])]),_:1}),t("main",Me,[g(l)])])}}}),He=M(Te,[["__scopeId","data-v-e944c3a0"]]);export{He as default};
