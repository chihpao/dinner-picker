import{_ as H}from"./DPvAsCCj.js";import{I as j,_ as z}from"./ivJW199t.js";import{_ as K}from"./BF6IhyWh.js";import{u as T,a as p}from"./D8w1TNDh.js";import{e as V,r as O,l as E,k as M,c as i,o as l,q as y,i as G,f as n,a as t,t as d,F as C,h as J,n as h,s as w,v as $,x as Q,b,g as R,T as W,m as X,u as Y,w as x}from"./lYf44GPV.js";import{I as Z}from"./BbR-qeLV.js";import{u as D}from"./DSc9tJYb.js";import{u as N}from"./BrKs8iOl.js";import{_ as tt}from"./DlAUqK2U.js";const st={class:"panel"},et={key:0,class:"panel-header"},nt={class:"pill"},at={key:1,class:"auth-gate panel"},ot={key:0,class:"empty-state"},lt={key:1,class:"account-list"},it={key:0,class:"edit-mode-layout"},rt={class:"edit-grid"},dt={class:"input-group"},ct={class:"input-group"},ut={class:"type-select-wrapper"},mt={class:"input-group full-width"},pt={class:"amount-input-wrapper"},_t={class:"edit-actions"},bt=["onClick"],vt={class:"card-top"},ft={class:"account-info"},kt={class:"card-actions"},gt=["onClick"],yt=["onClick"],Ct={class:"card-stats"},ht={class:"stat-row"},wt={class:"stat-value"},xt={class:"stat-row"},It={class:"stat-value income"},At={class:"stat-row"},Et={class:"stat-value expense"},Mt={class:"card-balance"},$t={key:0,class:"account-card ghost"},Tt={class:"card-stats"},Vt={class:"stat-row"},Dt={class:"stat-value income"},Nt={class:"stat-row"},St={class:"stat-value expense"},qt={class:"card-balance"},Bt={class:"balance-amount"},Ft=V({__name:"AccountPanel",setup(S){const{user:f}=T(),{accounts:m,updateAccount:g,deleteAccount:I}=D(),{entries:v}=N(),c=O(null),o=E({name:"",kind:"bank",balance:0}),r=E({open:!1,targetId:null}),_=M(()=>{const e=new Map;return v.value.forEach(s=>{if(!s.account_id)return;const a=e.get(s.account_id)||{income:0,expense:0,net:0};s.amount<0?a.income+=Math.abs(s.amount):a.expense+=s.amount,a.net+=s.amount,e.set(s.account_id,a)}),e}),k=M(()=>v.value.reduce((e,s)=>(s.account_id||(s.amount<0?e.income+=Math.abs(s.amount):e.expense+=s.amount,e.net+=s.amount,e.count++),e),{income:0,expense:0,net:0,count:0})),q=e=>e==="cash"?"現金":e==="card"?"信用卡":"銀行",B=e=>{r.targetId=e,r.open=!0},A=()=>{r.open=!1,r.targetId=null},F=async()=>{r.targetId&&(await I(r.targetId),r.open=!1,r.targetId=null)},L=e=>{c.value=e.id,o.name=e.name,o.kind=e.kind,o.balance=e.balance??0},P=()=>{c.value=null},U=async e=>{if(!f.value)return;const s=m.value.find(a=>a.id===e);if(!s){c.value=null;return}if(!o.name.trim()){alert("請輸入帳戶名稱");return}if(o.balance<0){alert("請輸入正確的初始金額");return}await g({...s,name:o.name.trim(),kind:o.kind,balance:Math.round(o.balance)}),c.value=null};return(e,s)=>(l(),i("section",st,[n(m).length?(l(),i("div",et,[t("span",nt,"共 "+d(n(m).length)+" 個帳戶",1)])):y("",!0),n(f)?(l(),i(C,{key:2},[n(m).length?(l(),i("div",lt,[(l(!0),i(C,null,J(n(m),a=>(l(),i("article",{key:a.id,class:h(["account-card",{editing:n(c)===a.id}])},[n(c)===a.id?(l(),i("div",it,[s[10]||(s[10]=t("div",{class:"edit-header"},[t("h3",null,"編輯帳戶")],-1)),t("div",rt,[t("label",dt,[s[4]||(s[4]=t("span",{class:"label-text"},"帳戶名稱",-1)),w(t("input",{"onUpdate:modelValue":s[0]||(s[0]=u=>n(o).name=u),type:"text",placeholder:"例如：台新銀行",required:"",class:"form-input"},null,512),[[$,n(o).name]])]),t("label",ct,[s[7]||(s[7]=t("span",{class:"label-text"},"類型",-1)),t("div",ut,[w(t("select",{"onUpdate:modelValue":s[1]||(s[1]=u=>n(o).kind=u),class:"form-select"},[...s[5]||(s[5]=[t("option",{value:"bank"},"銀行帳戶",-1),t("option",{value:"card"},"信用卡",-1),t("option",{value:"cash"},"現金 / 錢包",-1)])],512),[[Q,n(o).kind]]),s[6]||(s[6]=t("span",{class:"select-arrow"},"▼",-1))])]),t("label",mt,[s[9]||(s[9]=t("span",{class:"label-text"},"初始餘額",-1)),t("div",pt,[s[8]||(s[8]=t("span",{class:"currency-symbol"},"NT$",-1)),w(t("input",{"onUpdate:modelValue":s[2]||(s[2]=u=>n(o).balance=u),type:"number",class:"form-input amount-input",required:""},null,512),[[$,n(o).balance,void 0,{number:!0}]])])])]),t("div",_t,[t("button",{class:"btn btn-sm",type:"button",onClick:P},"取消"),t("button",{class:"btn btn-sm primary",type:"button",onClick:u=>U(a.id)},"儲存變更",8,bt)])])):(l(),i(C,{key:1},[t("div",vt,[t("div",ft,[t("h3",null,d(a.name),1),t("span",{class:h(["kind-tag",a.kind])},d(q(a.kind)),3)]),t("div",kt,[t("button",{class:"icon-btn",onClick:u=>L(a),title:"編輯"},[b(Z)],8,gt),t("button",{class:"icon-btn danger",onClick:u=>B(a.id),title:"刪除"},[b(j)],8,yt)])]),t("div",Ct,[t("div",ht,[s[11]||(s[11]=t("span",{class:"stat-label"},"初始",-1)),t("span",wt,d(("formatCurrency"in e?e.formatCurrency:n(p))(a.balance||0)),1)]),t("div",xt,[s[12]||(s[12]=t("span",{class:"stat-label"},"收入",-1)),t("span",It,"+"+d(("formatCurrency"in e?e.formatCurrency:n(p))(n(_).get(a.id)?.income||0)),1)]),t("div",At,[s[13]||(s[13]=t("span",{class:"stat-label"},"支出",-1)),t("span",Et,"-"+d(("formatCurrency"in e?e.formatCurrency:n(p))(n(_).get(a.id)?.expense||0)),1)])]),t("div",Mt,[s[14]||(s[14]=t("span",{class:"balance-label"},"目前餘額",-1)),t("span",{class:h(["balance-amount",{negative:(a.balance||0)-(n(_).get(a.id)?.net||0)<0}])},d(("formatCurrency"in e?e.formatCurrency:n(p))((a.balance||0)-(n(_).get(a.id)?.net||0))),3)])],64))],2))),128)),n(k).count>0?(l(),i("article",$t,[s[18]||(s[18]=t("div",{class:"card-top"},[t("div",{class:"account-info"},[t("h3",null,"未指定帳戶"),t("span",{class:"kind-tag other"},"其他")])],-1)),t("div",Tt,[t("div",Vt,[s[15]||(s[15]=t("span",{class:"stat-label"},"收入",-1)),t("span",Dt,"+"+d(("formatCurrency"in e?e.formatCurrency:n(p))(n(k).income)),1)]),t("div",Nt,[s[16]||(s[16]=t("span",{class:"stat-label"},"支出",-1)),t("span",St,"-"+d(("formatCurrency"in e?e.formatCurrency:n(p))(n(k).expense)),1)])]),t("div",qt,[s[17]||(s[17]=t("span",{class:"balance-label"},"淨支出",-1)),t("span",Bt,d(("formatCurrency"in e?e.formatCurrency:n(p))(n(k).net)),1)])])):y("",!0)])):(l(),i("div",ot,"尚未建立帳戶，先新增一個吧！"))],64)):(l(),i("div",at,[...s[3]||(s[3]=[t("p",null,"請先登入再管理帳戶",-1)])])),(l(),G(W,{to:"body"},[n(r).open?(l(),i("div",{key:0,class:"modal-overlay",onClick:R(A,["self"])},[t("div",{class:"modal-card"},[s[19]||(s[19]=t("div",{class:"modal-header"},[t("h3",null,"刪除帳戶")],-1)),s[20]||(s[20]=t("div",{class:"modal-content"},[t("p",null,"確定要刪除這個帳戶嗎？"),t("p",{class:"warning-text"},"相關的記帳紀錄即使刪除帳戶後仍會保留，但會變成「未指定帳戶」。")],-1)),t("div",{class:"modal-actions"},[t("button",{class:"btn",onClick:A},"取消"),t("button",{class:"btn danger",onClick:F},"確認刪除")])])])):y("",!0)]))]))}}),Lt=Object.assign(tt(Ft,[["__scopeId","data-v-6745572e"]]),{__name:"AccountPanel"}),Pt={class:"expense-main"},Rt=V({__name:"accounts",setup(S){const{user:f}=T(),{loadEntries:m}=N(),{loadAccounts:g}=D();return X(f,()=>{m(),g()},{immediate:!0}),Y({title:"帳戶管理｜今晚吃哪家？",meta:[{name:"theme-color",content:"#1b1b1b"}]}),(I,v)=>{const c=H,o=z,r=K,_=Lt;return l(),i("div",null,[b(r,{title:"帳戶管理","is-expenses":!0,"back-to":"/total"},{actions:x(()=>[b(c,{to:"/total/add-account",class:"btn btn-sm primary",title:"新增帳戶","aria-label":"新增帳戶"},{default:x(()=>[...v[0]||(v[0]=[t("span",null,"+",-1)])]),_:1})]),bottom:x(()=>[b(o)]),_:1}),t("main",Pt,[b(_)])])}}});export{Rt as default};
